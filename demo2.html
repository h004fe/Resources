<html lang="ja">
  <head>
    <meta charset="utf-8"/>
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
  </head>
  <body>
    <py-script>
        import ipywidgets as widgets
from ipywidgets import RadioButtons, Layout
from IPython.display import clear_output

#Hidden code cells
# @title
import IPython
from IPython.display import display, HTML

htm = HTML('''
<script>
function code_toggle() {
 $('div.input').hide();
}
$( document ).ready(code_toggle);
</script>
''')

#if not is_disp_code:
display(htm)

#definition of global variables
global sel_chap
sel_chap = None
global sel_sec
sel_sec = None
global destination
destination = None
global cur_dir
cur_dir = None
global is_called_toc
is_called_toc = True
global l_strip
l_strip = []


#return radio object from mapping
def create_radio(target_map):
  radio_obj = RadioButtons(
      options = [target_map[key] for key in target_map],
      layout=Layout(margin='0 0 0 5%'),
      disabled=False,
      )
  radio_obj.selected_index = None
  #print(radio_obj)
  radio_obj.observe(test_eventhandler_rb)
  #test

  #display(obj)
  return radio_obj

#https://stackoverflow.com/questions/8924173/how-can-i-print-bold-text-in-python
def bold(
    text,
    trans=str.maketrans(
        "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",
        "𝗔𝗕𝗖𝗗𝗘𝗙𝗚𝗛𝗜𝗝𝗞𝗟𝗠𝗡𝗢𝗣𝗤𝗥𝗦𝗧𝗨𝗩𝗪𝗫𝗬𝗭𝗮𝗯𝗰𝗱𝗲𝗳𝗴𝗵𝗶𝗷𝗸𝗹𝗺𝗻𝗼𝗽𝗾𝗿𝘀𝘁𝘂𝘃𝘄𝘅𝘆𝘇𝟬𝟭𝟮𝟯𝟰𝟱𝟲𝟳𝟴𝟵",
    ),
):
    return text.translate(trans)

#definition of local variables
lst_map = []
lst_radio = []
map_sections = dict()

def load_profile(path):
    with open(path) as f:
      global l_strip
      l_strip = [s.rstrip() for s in f.readlines()]
      #print(l_strip)

    num_chap = 1
    num_sec = 0
    is_ommit = True
    map_sections = dict()
    for item in l_strip:
      if is_ommit and item == '':
        is_ommit = False
        continue
      elif is_ommit and item != '':
        continue
      elif not is_ommit and item == '':
        num_chap = num_chap + 1
        num_sec = 0
        lst_map.append(map_sections)
        map_sections = dict()
        continue

      key = str(num_chap) + '.' + str(num_sec)
      if 0 == num_sec:
        item = bold(item)
      map_sections[key] = item
      num_sec = num_sec +1
    #print(lst_test)


#radio button event
def test_eventhandler_rb(obj):
  idx = None
  target_value = obj["new"]
  try:
    idx = int(target_value) - 1
  except Exception as e:
    #print("RB cast exception!")
    has_err = True
  if idx is not None:
      #print("OK")
      #global sel_sec
      sel_sec = idx + 1
      #print(idx)
      #print(sel_chap)
      #print(sel_sec)
      #print("===")
      global destination
      global cur_dir 
      cur_dir = "../" + str(sel_chap) + "-" + str(sel_sec) + "/"
      destination = cur_dir + "launcher.ipynb"
      #print(destination)
      btn_read.disabled = False
        
#accordion event
def test_eventhandler_acc(obj):
  idx = None
  target_dict = dict()
  target_dict = obj["new"]
  #print(obj)
  try:
    idx = target_dict['selected_index']

  except Exception as e:
    #print("ex")
    has_err = True

  if idx is not None:
    #print("Do nothing , only set to variables...")
    #global sel_chap
    sel_chap = idx + 1
    global sel_sec
    #print(sel_sec)
    sel_sec = 1
    #global is_change_chap
    is_change_chap = True

    #print(sel_chap)
    #print(sel_sec)
    global destination
    global cur_dir
    cur_dir = "../" + str(sel_chap) + "-" + str(sel_sec) + "/"
    destination = cur_dir + "launcher.ipynb"
    #print(destination)
    btn_read.disabled = False
    


#global map_sections
map_sections = dict()
load_profile("./profile.txt")
lst_radio = []
for title_map in lst_map:
  lst_radio.append(create_radio(title_map))



#create accordion
lst_title = []
i = 0
for obj in lst_map:
  lst_title.append(bold("Chapter " + str(i + 1) + ". " + obj[str(i + 1) + ".0"]))
  #accordion.set_title(1, 'Chapter 2. Basic Topology')
  i = i + 1

#print(lst_title)
accordion = widgets.Accordion(
    children = [obj for obj in lst_radio],
    titles = [obj for obj in lst_title] #for 8.0.0
)

#idxx = 0

accordion.selected_index = None
accordion.observe(test_eventhandler_acc)
btn_read = widgets.Button(
    description='Start Reading',
    disabled=True,
    button_style='', # 'success', 'info', 'warning', 'danger' or ''
    tooltip='Read',
    icon='check'
)

btn_back = widgets.Button(
    description='Back',
    disabled=False,
    button_style='', # 'success', 'info', 'warning', 'danger' or ''
    tooltip='Back',
    icon='check'
)

def btn_back_eventhandler(obj):
    from IPython.display import clear_output
    clear_output(True)
    %run "./toc4.ipynb"
    
btn_back.on_click(btn_back_eventhandler)

def btn_read_eventhandler(obj):
  #print(sel_chap)
  #print(sel_sec)
  #print(destination)
  #path = ""
  global is_called_toc
  is_called_toc = True
  test_destination = destination
  #from IPython.display import clear_output
  clear_output(True)
  display(btn_back)
  display(widgets.HTML(value = f"&nbsp;<br>&nbsp;<br>&nbsp;<br>"))
  try:
    %run $test_destination
  except Exception as e:
    msg="Some error has happen..."
    display(widgets.HTML(value = f"<b><font size='4'>{msg}</b>"))
  display(btn_back)
  #display(test_destination)
  #definition to load launcher.ipynb

btn_read.on_click(btn_read_eventhandler)
#print(l_strip[0])
author = l_strip[0]
display(widgets.HTML(value = f"<b><font size='6'>{author}</b>"))
title = l_strip[1]
display(widgets.HTML(value = f"<b><font size='4'>{title}</b>"))
#display(widgets.Label(value=l_strip[0]))
#display(widgets.Label(value=l_strip[1]))

#file = open("./cover.jpeg", "rb")
#image = file.read()
#display(widgets.Image(
    #value=image,
    #format='jpeg',
    #width=300,
    #height=400,
#))
display(widgets.HTML(value = f"&nbsp;<br>&nbsp;<br>&nbsp;<br>"))
display(btn_read)
sel_chap = 1
sel_sec = 1
#btn_read.disabled = True
accordion_main = widgets.Accordion(children=[accordion], 
                                   titles=['Table of contents'])
display(accordion_main)
    </py-script>
  </body>
</html>